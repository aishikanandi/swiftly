(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[11],{6011:(kt,pt,D)=>{"use strict";D.r(pt),D.d(pt,{RidehistoryModule:()=>P});var V=D(177),Q=D(8498),W=D(5351),t=D(7705);let Z=(()=>{class a{constructor(i,r,p){this.dialog=i,this.dialogRef=r,this.data=p,this.dataArray=[],this.map=null,this.polyline=null,this.startMarker=null,this.endMarker=null}ngOnInit(){this.dataArray=this.data,this.initMap()}initMap(){this.geocodeAddress(this.data.startLocation,i=>{this.geocodeAddress(this.data.endLocation,r=>{const p={center:i,zoom:14};this.map=new google.maps.Map(document.getElementById("map"),p),this.drawPolyline(i,r)})})}geocodeAddress(i,r){(new google.maps.Geocoder).geocode({address:i},(c,o)=>{"OK"===o?r(c[0].geometry.location):console.error("Geocode was not successful for the following reason: "+o)})}drawPolyline(i,r){this.polyline=new google.maps.Polyline({path:[i,r],geodesic:!0,strokeColor:"#0048ff",strokeOpacity:1,strokeWeight:3}),this.polyline.setMap(this.map);const c=new google.maps.LatLngBounds;c.extend(i),c.extend(r),this.map.fitBounds(c),this.addMarker(i,"Start Location"),this.addMarker(r,"End Location")}addMarker(i,r){const c=new google.maps.Marker({position:i,map:this.map,title:r});c.setMap(this.map),"Start Location"===r?this.startMarker=c:"End Location"===r&&(this.endMarker=c)}static{this.\u0275fac=function(r){return new(r||a)(t.rXU(W.bZ),t.rXU(W.CP),t.rXU(W.Vh))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-ridehistorydialog"]],decls:0,vars:0,template:function(r,p){},styles:[".info-component[_ngcontent-%COMP%]{overflow:hidden}.ride-details-dialog[_ngcontent-%COMP%]{text-align:center}.ride-details[_ngcontent-%COMP%]{margin-bottom:10px}.details-key[_ngcontent-%COMP%]{font-weight:700;white-space:nowrap}.details-value[_ngcontent-%COMP%]{white-space:nowrap}.info-button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;border:none;border-radius:4px;background-color:#830fff;color:#fff;cursor:pointer}.fit-image[_ngcontent-%COMP%]{max-width:100px;max-height:100px;border-radius:50%}.map-container[_ngcontent-%COMP%]{width:90%;margin:20px auto}#map[_ngcontent-%COMP%]{width:100%;height:300px}@media (max-width: 767px){.ride-details-dialog[_ngcontent-%COMP%]{padding:20px}}"]})}}return a})();var ct=D(1626);let st=(()=>{class a{constructor(i){this.http=i,this.serverUrl="http://localhost:4000"}downlaodallData(i){return this.http.post(`${this.serverUrl}/downloadridehistory`,{alldataatonce:i})}static{this.\u0275fac=function(r){return new(r||a)(t.KVO(ct.Qq))}}static{this.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var _t=D(3037),g=D(2709),tt=D(2758),N=D(262),ot=D.t(N,2);let at=(()=>{class a{constructor(){this._papa=ot}parse(i,r){return this._papa.parse(i,r)}unparse(i,r){return this._papa.unparse(i,r)}setLocalChunkSize(i){this._papa.LocalChunkSize=i}setRemoteChunkSize(i){this._papa.RemoteChunkSize=i}setDefaultDelimiter(i){this._papa.DefaultDelimiter=i}get badDelimiters(){return this._papa.BAD_DELIMITERS}get recordSeparator(){return this._papa.RECORD_SEP}get unitSeparator(){return this._papa.UNIT_SEP}get workersSupported(){return this._papa.WORKERS_SUPPORTED}}return a.\u0275fac=function(i){return new(i||a)},a.\u0275prov=t.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();var et=D(6731),A=D(9417),dt=D(415);function nt(a,d){1&a&&(t.j41(0,"div",23),t.EFF(1," No Records Found "),t.k0s())}function lt(a,d){if(1&a&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&a){const i=t.XpG().$implicit;t.R7$(1),t.JRh(i.feedback)}}function yt(a,d){1&a&&(t.j41(0,"td"),t.EFF(1,"No feedback"),t.k0s())}function ft(a,d){1&a&&(t.j41(0,"span"),t.nrm(1,"i",35),t.k0s())}const gt=function(){return[]};function ut(a,d){if(1&a&&(t.j41(0,"td"),t.DNE(1,ft,2,0,"span",34),t.k0s()),2&a){const i=t.XpG().$implicit;t.R7$(1),t.Y8G("ngForOf",t.lJ4(1,gt).constructor(i.rating))}}function B(a,d){1&a&&(t.j41(0,"td"),t.EFF(1,"No Rating"),t.k0s())}const v=function(a,d){return{"badge-success":a,"badge-danger":d}};function n(a,d){if(1&a){const i=t.RV6();t.j41(0,"tr",18),t.bIt("click",function(){const c=t.eBV(i).$implicit,o=t.XpG(2);return t.Njj(o.openInfoDialog(c))}),t.j41(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td",32),t.EFF(8),t.k0s(),t.j41(9,"td",32),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.EFF(14),t.k0s(),t.DNE(15,lt,2,1,"td",22),t.DNE(16,yt,2,0,"td",22),t.DNE(17,ut,2,2,"td",22),t.DNE(18,B,2,0,"td",22),t.j41(19,"td",33),t.EFF(20),t.k0s()()}if(2&a){const i=d.$implicit,r=t.XpG(2);t.R7$(2),t.JRh(i._id),t.R7$(2),t.JRh(i.userDetails.username),t.R7$(2),t.JRh(i.rideDate),t.R7$(2),t.JRh(i.startLocation),t.R7$(2),t.JRh(i.endLocation),t.R7$(2),t.JRh(i.serviceType),t.R7$(2),t.JRh(i.paymentOption),t.R7$(1),t.Y8G("ngIf",void 0!==i.feedback&&""!==i.feedback),t.R7$(1),t.Y8G("ngIf",void 0===i.feedback||""===i.feedback),t.R7$(1),t.Y8G("ngIf",void 0!==i.rating&&i.rating>0),t.R7$(1),t.Y8G("ngIf",void 0===i.rating||0===i.rating),t.R7$(1),t.Y8G("ngClass",t.l_i(13,v,7===i.ridestatus,3===i.ridestatus)),t.R7$(1),t.SpI(" ",r.statusLabels[i.ridestatus]||"unknown"," ")}}const e=function(a,d,i){return{itemsPerPage:a,currentPage:d,totalItems:i}};function s(a,d){if(1&a){const i=t.RV6();t.j41(0,"div")(1,"div",24)(2,"div",25)(3,"div",26)(4,"table",27)(5,"thead",28)(6,"tr")(7,"th"),t.EFF(8,"Req. ID"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Username"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Pick up Date"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Pick up Address"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Delivery Address"),t.k0s(),t.j41(17,"th"),t.EFF(18,"Service Type"),t.k0s(),t.j41(19,"th"),t.EFF(20,"Payment"),t.k0s(),t.j41(21,"th"),t.EFF(22,"Feedback"),t.k0s(),t.j41(23,"th"),t.EFF(24,"Rating"),t.k0s(),t.j41(25,"th"),t.EFF(26,"Status"),t.k0s()()(),t.j41(27,"tbody"),t.DNE(28,n,21,16,"tr",29),t.nI1(29,"paginate"),t.k0s()()()()(),t.j41(30,"div",30)(31,"pagination-controls",31),t.bIt("pageChange",function(p){t.eBV(i);const c=t.XpG();return t.Njj(c.onPageChange(p))}),t.k0s()()()}if(2&a){const i=t.XpG();t.R7$(28),t.Y8G("ngForOf",t.i5U(29,3,i.ridesArray,t.sMw(6,e,i.limit,i.currentPage,i.count))),t.R7$(3),t.Y8G("maxSize",5)("responsive",!0)}}let h=(()=>{class a{constructor(i,r,p,c,o,_,R){this._ridehistroy=i,this._confirmride=r,this._runningrequest=p,this._socket=c,this.papa=o,this.dialog=_,this.authService=R,this.ridesArray=[],this.statusLabels={3:"Cancelled",7:"Delivered"},this.currentPage=1,this.limit=5,this.totalPages=0,this.paginatedRideData=[],this.startlocation="",this.endlocation="",this.paymentmode="",this.Fromdate="",this.Todate="",this.ridestatus=-1}ngOnInit(){this.getRideHistory(),this.aftercancelrideinrealtime(),this.ridestatusupdates()}getRideHistory(){this._socket.emitridehistory({page:this.currentPage,limit:this.limit,payment:this.paymentmode,fromdate:this.Fromdate,todate:this.Todate,status:this.ridestatus,startlocationsearch:this.startlocation,endlocationsearch:this.endlocation}),this._socket.listenridehistory().subscribe(r=>{console.log(r),this.ridesArray=r.myridehistory,this.totalPages=r.totalPages,this.count=r.totalCount})}onPageSizeChange(i){this.limit=parseInt(i.target.value),this.currentPage=1,this.updatePaginatedDrivers(),this.getRideHistory()}onPageChange(i){i>=1&&i<=this.totalPages&&(this.currentPage=i,this.updatePaginatedDrivers(),this.getRideHistory())}updatePaginatedDrivers(){const i=(this.currentPage-1)*this.limit;this.paginatedRideData=this.ridesArray.slice(i,i+this.limit)}clearFilter(){this.ridestatus=-1,this.paymentmode="",this.startlocation="",this.endlocation="",this.Fromdate="",this.Todate="",this.getRideHistory()}aftercancelrideinrealtime(){this._socket.listencancelride().subscribe(i=>{this.getRideHistory()})}ridestatusupdates(){this._socket.listeningrideupdates().subscribe(i=>{this.getRideHistory()})}downlaodallData(){this._ridehistroy.downlaodallData({payment:this.paymentmode,fromdate:this.Fromdate,todate:this.Todate,status:this.ridestatus,startlocationsearch:this.startlocation,endlocationsearch:this.endlocation}).subscribe({next:r=>{const c=this.convertToCSV(r.myridehistory),o=new Blob([c],{type:"text/csv"}),_="data_"+(new Date).getTime()+".csv",R=document.createElement("a");R.href=window.URL.createObjectURL(o),R.download=_,R.click()},error:r=>{console.log(r.error.message)}})}convertToCSV(i){const r=[["Req. Id","Username","User Email","Start Location","End Location","Way Points","Ride Date","Ride Time","Time","Service Type","Payment Option","Estimate Time","Estimate Fare","Ride Status"]];return i.forEach(c=>{r.push([c._id,c.userDetails?.username||"",c.userDetails?.useremail||"",c.startLocation||"",c.endLocation||"",c.wayPoints,c.rideDate||"",c.rideTime||"",c.time,c.serviceType,c.paymentOption,c.estimateTime,c.estimateFare||"",c.ridestatus||""])}),this.papa.unparse(r)}openInfoDialog(i){const r=new W.ru;r.disableClose=!1,r.autoFocus=!0,r.width="600px",r.data=i,this.dialog.open(Z,r)}resetTimer(){this.authService.resetInactivityTimer()}static{this.\u0275fac=function(r){return new(r||a)(t.rXU(st),t.rXU(_t.K),t.rXU(g.c),t.rXU(tt.L),t.rXU(at),t.rXU(W.bZ),t.rXU(et.u))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-ridehistory"]],decls:44,vars:11,consts:[[1,"container","mt-2"],[1,"filter-section"],["id","filter-dropdown",3,"ngModel","ngModelChange"],["value","-1"],[3,"value"],["value",""],["value","cash"],["value","card"],["type","date","id","search-input",3,"ngModel","ngModelChange"],["type","text","id","search-input","placeholder","Start Location...",3,"ngModel","ngModelChange"],["type","text","id","search-input","placeholder","End Location...",3,"ngModel","ngModelChange"],[1,"custom-select"],["id","pageSize",1,"m-2",3,"ngModel","ngModelChange","change"],["value","5"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"click"],[1,"fa-solid","fa-download"],[1,"container","mt-4"],["class","no-records-label",4,"ngIf"],[4,"ngIf"],[1,"no-records-label"],[1,"parentFormContainer","p-4","border","rounded"],["id","tableContainer"],[1,"table-responsive"],[1,"table"],[1,"bg-light","text-dark"],[3,"click",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-4"],[3,"maxSize","responsive","pageChange"],[1,"fixed-width"],[1,"badge",3,"ngClass"],[4,"ngFor","ngForOf"],["aria-hidden","true",1,"fa","fa-star","text-warning"]],template:function(r,p){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"select",2),t.bIt("ngModelChange",function(o){return p.ridestatus=o}),t.j41(3,"option",3),t.EFF(4,"Select Status"),t.k0s(),t.j41(5,"option",4),t.EFF(6,"Cancelled"),t.k0s(),t.j41(7,"option",4),t.EFF(8,"Completed"),t.k0s()(),t.j41(9,"select",2),t.bIt("ngModelChange",function(o){return p.paymentmode=o}),t.j41(10,"option",5),t.EFF(11,"Select Payment"),t.k0s(),t.j41(12,"option",6),t.EFF(13,"Cash"),t.k0s(),t.j41(14,"option",7),t.EFF(15,"Card"),t.k0s()(),t.j41(16,"input",8),t.bIt("ngModelChange",function(o){return p.Fromdate=o}),t.k0s(),t.j41(17,"input",8),t.bIt("ngModelChange",function(o){return p.Todate=o}),t.k0s(),t.j41(18,"input",9),t.bIt("ngModelChange",function(o){return p.startlocation=o}),t.k0s(),t.j41(19,"input",10),t.bIt("ngModelChange",function(o){return p.endlocation=o}),t.k0s(),t.j41(20,"div",11)(21,"select",12),t.bIt("ngModelChange",function(o){return p.limit=o})("change",function(o){return p.onPageSizeChange(o)}),t.j41(22,"option",13),t.EFF(23,"Select Page"),t.k0s(),t.j41(24,"option",13),t.EFF(25,"5"),t.k0s(),t.j41(26,"option",14),t.EFF(27,"10"),t.k0s(),t.j41(28,"option",15),t.EFF(29,"20"),t.k0s(),t.j41(30,"option",16),t.EFF(31,"50"),t.k0s(),t.j41(32,"option",17),t.EFF(33,"100"),t.k0s()()(),t.j41(34,"button",18),t.bIt("click",function(){return p.getRideHistory()}),t.EFF(35,"Apply Filter"),t.k0s(),t.j41(36,"button",18),t.bIt("click",function(){return p.clearFilter()}),t.EFF(37,"Clear Filter"),t.k0s(),t.j41(38,"button",18),t.bIt("click",function(){return p.downlaodallData()}),t.nrm(39,"i",19),t.EFF(40,"Download"),t.k0s()()(),t.j41(41,"div",20),t.DNE(42,nt,2,0,"div",21),t.DNE(43,s,32,10,"div",22),t.k0s()),2&r&&(t.R7$(2),t.Y8G("ngModel",p.ridestatus),t.R7$(3),t.Y8G("value",3),t.R7$(2),t.Y8G("value",7),t.R7$(2),t.Y8G("ngModel",p.paymentmode),t.R7$(7),t.Y8G("ngModel",p.Fromdate),t.R7$(1),t.Y8G("ngModel",p.Todate),t.R7$(1),t.Y8G("ngModel",p.startlocation),t.R7$(1),t.Y8G("ngModel",p.endlocation),t.R7$(2),t.Y8G("ngModel",p.limit),t.R7$(21),t.Y8G("ngIf",0===p.ridesArray.length),t.R7$(1),t.Y8G("ngIf",p.ridesArray.length>0))},dependencies:[V.YU,V.Sq,V.bT,A.xH,A.y7,A.me,A.wz,A.BC,A.vS,dt.ej,dt.kf],styles:[".badge[_ngcontent-%COMP%]{display:inline-block;padding:.25em .5em;margin:10px;font-size:1em;font-weight:700;border-radius:.25em}.badge-success[_ngcontent-%COMP%]{background-color:green;color:#fff}.badge-danger[_ngcontent-%COMP%]{background-color:red;color:#fff}.container[_ngcontent-%COMP%]{width:100%;margin:0 auto;padding:20px}.filter-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:20px}#filter-dropdown[_ngcontent-%COMP%], #pageSize[_ngcontent-%COMP%]{padding:5px}#search-input[_ngcontent-%COMP%]{flex-grow:1;padding:5px}#search-button[_ngcontent-%COMP%]{padding:10px 15px;background-color:#2196f3;color:#fff;border:none;cursor:pointer}.no-records-label[_ngcontent-%COMP%]{text-align:center;font-size:24px;font-weight:700;color:red;margin-top:20%}"]})}}return a})();const l=[{path:"",component:h}];let f=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[Q.iI.forChild(l),Q.iI]})}}return a})();const m=[{path:"",component:h,pathMatch:"full"}];let P=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[V.MD,f,Q.iI.forChild(m),A.YN,A.X1,dt.ed]})}}return a})()},262:function(kt,pt){var D,Q;D=function W(){"use strict";var t=typeof self<"u"?self:typeof window<"u"?window:void 0!==t?t:{},Z=!t.document&&!!t.postMessage,ct=t.IS_PAPA_WORKER||!1,st={},_t=0,g={parse:function(n,e){var s=(e=e||{}).dynamicTyping||!1;if(v(s)&&(e.dynamicTypingFunction=s,s={}),e.dynamicTyping=s,e.transform=!!v(e.transform)&&e.transform,e.worker&&g.WORKERS_SUPPORTED){var h=function(){if(!g.WORKERS_SUPPORTED)return!1;var P,a,f=(P=t.URL||t.webkitURL||null,a=W.toString(),g.BLOB_URL||(g.BLOB_URL=P.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",a,")();"],{type:"text/javascript"})))),m=new t.Worker(f);return m.onmessage=yt,m.id=_t++,st[m.id]=m}();return h.userStep=e.step,h.userChunk=e.chunk,h.userComplete=e.complete,h.userError=e.error,e.step=v(e.step),e.chunk=v(e.chunk),e.complete=v(e.complete),e.error=v(e.error),delete e.worker,void h.postMessage({input:n,config:e,workerId:h.id})}var f,l=null;return"string"==typeof n?(n=65279===(f=n).charCodeAt(0)?f.slice(1):f,l=e.download?new ot(e):new et(e)):!0===n.readable&&v(n.read)&&v(n.on)?l=new A(e):(t.File&&n instanceof File||n instanceof Object)&&(l=new at(e)),l.stream(n)},unparse:function(n,e){var s=!1,h=!0,l=",",f="\r\n",m='"',P=m+m,a=!1,d=null,i=!1;!function(){if("object"==typeof e){if("string"!=typeof e.delimiter||g.BAD_DELIMITERS.filter(function(o){return-1!==e.delimiter.indexOf(o)}).length||(l=e.delimiter),("boolean"==typeof e.quotes||"function"==typeof e.quotes||Array.isArray(e.quotes))&&(s=e.quotes),"boolean"!=typeof e.skipEmptyLines&&"string"!=typeof e.skipEmptyLines||(a=e.skipEmptyLines),"string"==typeof e.newline&&(f=e.newline),"string"==typeof e.quoteChar&&(m=e.quoteChar),"boolean"==typeof e.header&&(h=e.header),Array.isArray(e.columns)){if(0===e.columns.length)throw new Error("Option columns is empty");d=e.columns}void 0!==e.escapeChar&&(P=e.escapeChar+m),("boolean"==typeof e.escapeFormulae||e.escapeFormulae instanceof RegExp)&&(i=e.escapeFormulae instanceof RegExp?e.escapeFormulae:/^[=+\-@\t\r].*$/)}}();var r=new RegExp(nt(m),"g");if("string"==typeof n&&(n=JSON.parse(n)),Array.isArray(n)){if(!n.length||Array.isArray(n[0]))return p(null,n,a);if("object"==typeof n[0])return p(d||Object.keys(n[0]),n,a)}else if("object"==typeof n)return"string"==typeof n.data&&(n.data=JSON.parse(n.data)),Array.isArray(n.data)&&(n.fields||(n.fields=n.meta&&n.meta.fields||d),n.fields||(n.fields=Array.isArray(n.data[0])?n.fields:"object"==typeof n.data[0]?Object.keys(n.data[0]):[]),Array.isArray(n.data[0])||"object"==typeof n.data[0]||(n.data=[n.data])),p(n.fields||[],n.data||[],a);throw new Error("Unable to serialize unrecognized input");function p(o,_,R){var F="";"string"==typeof o&&(o=JSON.parse(o)),"string"==typeof _&&(_=JSON.parse(_));var S=Array.isArray(o)&&0<o.length,T=!Array.isArray(_[0]);if(S&&h){for(var x=0;x<o.length;x++)0<x&&(F+=l),F+=c(o[x],x);0<_.length&&(F+=f)}for(var u=0;u<_.length;u++){var y=S?o.length:_[u].length,E=!1,O=S?0===Object.keys(_[u]).length:0===_[u].length;if(R&&!S&&(E="greedy"===R?""===_[u].join("").trim():1===_[u].length&&0===_[u][0].length),"greedy"===R&&S){for(var k=[],j=0;j<y;j++)k.push(_[u][T?o[j]:j]);E=""===k.join("").trim()}if(!E){for(var b=0;b<y;b++)0<b&&!O&&(F+=l),F+=c(_[u][S&&T?o[b]:b],b);u<_.length-1&&(!R||0<y&&!O)&&(F+=f)}}return F}function c(o,_){if(null==o)return"";if(o.constructor===Date)return JSON.stringify(o).slice(1,25);var R=!1;i&&"string"==typeof o&&i.test(o)&&(o="'"+o,R=!0);var F=o.toString().replace(r,P);return(R=R||!0===s||"function"==typeof s&&s(o,_)||Array.isArray(s)&&s[_]||function(S,T){for(var x=0;x<T.length;x++)if(-1<S.indexOf(T[x]))return!0;return!1}(F,g.BAD_DELIMITERS)||-1<F.indexOf(l)||" "===F.charAt(0)||" "===F.charAt(F.length-1))?m+F+m:F}}};if(g.RECORD_SEP=String.fromCharCode(30),g.UNIT_SEP=String.fromCharCode(31),g.BYTE_ORDER_MARK="\ufeff",g.BAD_DELIMITERS=["\r","\n",'"',g.BYTE_ORDER_MARK],g.WORKERS_SUPPORTED=!Z&&!!t.Worker,g.NODE_STREAM_INPUT=1,g.LocalChunkSize=10485760,g.RemoteChunkSize=5242880,g.DefaultDelimiter=",",g.Parser=lt,g.ParserHandle=dt,g.NetworkStreamer=ot,g.FileStreamer=at,g.StringStreamer=et,g.ReadableStreamStreamer=A,t.jQuery){var tt=t.jQuery;tt.fn.parse=function(n){var e=n.config||{},s=[];return this.each(function(f){if("INPUT"!==tt(this).prop("tagName").toUpperCase()||"file"!==tt(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var m=0;m<this.files.length;m++)s.push({file:this.files[m],inputElem:this,instanceConfig:tt.extend({},e)})}),h(),this;function h(){if(0!==s.length){var m,P,a,d=s[0];if(v(n.before)){var i=n.before(d.file,d.inputElem);if("object"==typeof i){if("abort"===i.action)return"AbortError",m=d.file,P=d.inputElem,a=i.reason,void(v(n.error)&&n.error({name:"AbortError"},m,P,a));if("skip"===i.action)return void l();"object"==typeof i.config&&(d.instanceConfig=tt.extend(d.instanceConfig,i.config))}else if("skip"===i)return void l()}var r=d.instanceConfig.complete;d.instanceConfig.complete=function(p){v(r)&&r(p,d.file,d.inputElem),l()},g.parse(d.file,d.instanceConfig)}else v(n.complete)&&n.complete()}function l(){s.splice(0,1),h()}}}function N(n){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var s=ut(e);s.chunkSize=parseInt(s.chunkSize),e.step||e.chunk||(s.chunkSize=null),this._handle=new dt(s),(this._handle.streamer=this)._config=s}.call(this,n),this.parseChunk=function(e,s){if(this.isFirstChunk&&v(this._config.beforeFirstChunk)){var h=this._config.beforeFirstChunk(e);void 0!==h&&(e=h)}this.isFirstChunk=!1,this._halted=!1;var l=this._partialLine+e;this._partialLine="";var f=this._handle.parse(l,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var m=f.meta.cursor;this._finished||(this._partialLine=l.substring(m-this._baseIndex),this._baseIndex=m),f&&f.data&&(this._rowCount+=f.data.length);var P=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(ct)t.postMessage({results:f,workerId:g.WORKER_ID,finished:P});else if(v(this._config.chunk)&&!s){if(this._config.chunk(f,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);f=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(f.data),this._completeResults.errors=this._completeResults.errors.concat(f.errors),this._completeResults.meta=f.meta),this._completed||!P||!v(this._config.complete)||f&&f.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),P||f&&f.meta.paused||this._nextChunk(),f}this._halted=!0},this._sendError=function(e){v(this._config.error)?this._config.error(e):ct&&this._config.error&&t.postMessage({workerId:g.WORKER_ID,error:e,finished:!1})}}function ot(n){var e;(n=n||{}).chunkSize||(n.chunkSize=g.RemoteChunkSize),N.call(this,n),this._nextChunk=Z?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(s){this._input=s,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(e=new XMLHttpRequest,this._config.withCredentials&&(e.withCredentials=this._config.withCredentials),Z||(e.onload=B(this._chunkLoaded,this),e.onerror=B(this._chunkError,this)),e.open(this._config.downloadRequestBody?"POST":"GET",this._input,!Z),this._config.downloadRequestHeaders){var s=this._config.downloadRequestHeaders;for(var h in s)e.setRequestHeader(h,s[h])}this._config.chunkSize&&e.setRequestHeader("Range","bytes="+this._start+"-"+(this._start+this._config.chunkSize-1));try{e.send(this._config.downloadRequestBody)}catch(f){this._chunkError(f.message)}Z&&0===e.status&&this._chunkError()}},this._chunkLoaded=function(){var h;4===e.readyState&&(e.status<200||400<=e.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:e.responseText.length,this._finished=!this._config.chunkSize||this._start>=(null===(h=e.getResponseHeader("Content-Range"))?-1:parseInt(h.substring(h.lastIndexOf("/")+1))),this.parseChunk(e.responseText)))},this._chunkError=function(s){this._sendError(new Error(e.statusText||s))}}function at(n){var e,s;(n=n||{}).chunkSize||(n.chunkSize=g.LocalChunkSize),N.call(this,n);var h=typeof FileReader<"u";this.stream=function(l){this._input=l,s=l.slice||l.webkitSlice||l.mozSlice,h?((e=new FileReader).onload=B(this._chunkLoaded,this),e.onerror=B(this._chunkError,this)):e=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input;if(this._config.chunkSize){var f=Math.min(this._start+this._config.chunkSize,this._input.size);l=s.call(l,this._start,f)}var m=e.readAsText(l,this._config.encoding);h||this._chunkLoaded({target:{result:m}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(e.error)}}function et(n){var e;N.call(this,n=n||{}),this.stream=function(s){return e=s,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var s,h=this._config.chunkSize;return h?(s=e.substring(0,h),e=e.substring(h)):(s=e,e=""),this._finished=!e,this.parseChunk(s)}}}function A(n){N.call(this,n=n||{});var e=[],s=!0,h=!1;this.pause=function(){N.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){N.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){h&&1===e.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),e.length?this.parseChunk(e.shift()):s=!0},this._streamData=B(function(l){try{e.push("string"==typeof l?l:l.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(e.shift()))}catch(f){this._streamError(f)}},this),this._streamError=B(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=B(function(){this._streamCleanUp(),h=!0,this._streamData("")},this),this._streamCleanUp=B(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function dt(n){var e,s,h,l=Math.pow(2,53),f=-l,m=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,P=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,a=this,d=0,i=0,r=!1,p=!1,c=[],o={data:[],errors:[],meta:{}};if(v(n.step)){var _=n.step;n.step=function(u){if(o=u,S())F();else{if(F(),0===o.data.length)return;d+=u.data.length,n.preview&&d>n.preview?s.abort():(o.data=o.data[0],_(o,a))}}}function R(u){return"greedy"===n.skipEmptyLines?""===u.join("").trim():1===u.length&&0===u[0].length}function F(){return o&&h&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+g.DefaultDelimiter+"'"),h=!1),n.skipEmptyLines&&(o.data=o.data.filter(function(u){return!R(u)})),S()&&function(){if(o)if(Array.isArray(o.data[0])){for(var y=0;S()&&y<o.data.length;y++)o.data[y].forEach(u);o.data.splice(0,1)}else o.data.forEach(u);function u(E,O){v(n.transformHeader)&&(E=n.transformHeader(E,O)),c.push(E)}}(),function(){if(!o||!n.header&&!n.dynamicTyping&&!n.transform)return o;function u(E,O){var k,j=n.header?{}:[];for(k=0;k<E.length;k++){var w=k,b=E[k];n.header&&(w=k>=c.length?"__parsed_extra":c[k]),n.transform&&(b=n.transform(b,w)),b=T(w,b),"__parsed_extra"===w?(j[w]=j[w]||[],j[w].push(b)):j[w]=b}return n.header&&(k>c.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+c.length+" fields but parsed "+k,i+O):k<c.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+c.length+" fields but parsed "+k,i+O)),j}var y=1;return!o.data.length||Array.isArray(o.data[0])?(o.data=o.data.map(u),y=o.data.length):o.data=u(o.data,0),n.header&&o.meta&&(o.meta.fields=c),i+=y,o}()}function S(){return n.header&&0===c.length}function T(u,y){return E=u,n.dynamicTypingFunction&&void 0===n.dynamicTyping[E]&&(n.dynamicTyping[E]=n.dynamicTypingFunction(E)),!0===(n.dynamicTyping[E]||n.dynamicTyping)?"true"===y||"TRUE"===y||"false"!==y&&"FALSE"!==y&&(function(O){if(m.test(O)){var k=parseFloat(O);if(f<k&&k<l)return!0}return!1}(y)?parseFloat(y):P.test(y)?new Date(y):""===y?null:y):y;var E}function x(u,y,E,O){var k={type:u,code:y,message:E};void 0!==O&&(k.row=O),o.errors.push(k)}this.parse=function(u,y,E){if(n.newline||(n.newline=function(w,b){w=w.substring(0,1048576);var G=new RegExp(nt(b)+"([^]*?)"+nt(b),"gm"),L=(w=w.replace(G,"")).split("\r"),Y=w.split("\n");if(1===L.length||1<Y.length&&Y[0].length<L[0].length)return"\n";for(var U=0,M=0;M<L.length;M++)"\n"===L[M][0]&&U++;return U>=L.length/2?"\r\n":"\r"}(u,n.quoteChar||'"')),h=!1,n.delimiter)v(n.delimiter)&&(n.delimiter=n.delimiter(u),o.meta.delimiter=n.delimiter);else{var k=function(w,b,G,L,Y){var H,U,M,I;Y=Y||[",","\t","|",";",g.RECORD_SEP,g.UNIT_SEP];for(var it=0;it<Y.length;it++){var C=Y[it],ht=0,K=0,rt=0;M=void 0;for(var X=new lt({comments:L,delimiter:C,newline:b,preview:10}).parse(w),J=0;J<X.data.length;J++)if(G&&R(X.data[J]))rt++;else{var q=X.data[J].length;K+=q,void 0!==M?0<q&&(ht+=Math.abs(q-M),M=q):M=q}0<X.data.length&&(K/=X.data.length-rt),(void 0===U||ht<=U)&&(void 0===I||I<K)&&1.99<K&&(U=ht,H=C,I=K)}return{successful:!!(n.delimiter=H),bestDelimiter:H}}(u,n.newline,n.skipEmptyLines,n.comments,n.delimitersToGuess);k.successful?n.delimiter=k.bestDelimiter:(h=!0,n.delimiter=g.DefaultDelimiter),o.meta.delimiter=n.delimiter}var j=ut(n);return n.preview&&n.header&&j.preview++,e=u,s=new lt(j),o=s.parse(e,y,E),F(),r?{meta:{paused:!0}}:o||{meta:{paused:!1}}},this.paused=function(){return r},this.pause=function(){r=!0,s.abort(),e=v(n.chunk)?"":e.substring(s.getCharIndex())},this.resume=function(){a.streamer._halted?(r=!1,a.streamer.parseChunk(e,!0)):setTimeout(a.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,s.abort(),o.meta.aborted=!0,v(n.complete)&&n.complete(o),e=""}}function nt(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function lt(n){var e,s=(n=n||{}).delimiter,h=n.newline,l=n.comments,f=n.step,m=n.preview,P=n.fastMode,a=e=null==n.quoteChar?'"':n.quoteChar;if(void 0!==n.escapeChar&&(a=n.escapeChar),("string"!=typeof s||-1<g.BAD_DELIMITERS.indexOf(s))&&(s=","),l===s)throw new Error("Comment character same as delimiter");!0===l?l="#":("string"!=typeof l||-1<g.BAD_DELIMITERS.indexOf(l))&&(l=!1),"\n"!==h&&"\r"!==h&&"\r\n"!==h&&(h="\n");var d=0,i=!1;this.parse=function(r,p,c){if("string"!=typeof r)throw new Error("Input must be a string");var o=r.length,_=s.length,R=h.length,F=l.length,S=v(f),T=[],x=[],u=[],y=d=0;if(!r)return z();if(n.header&&!p){var E=r.split(h)[0].split(s),O=[],k={},j=!1;for(var w in E){var b=E[w];v(n.transformHeader)&&(b=n.transformHeader(b,w));var G=b,L=k[b]||0;for(0<L&&(j=!0,G=b+"_"+L),k[b]=L+1;O.includes(G);)G=G+"_"+L;O.push(G)}if(j){var Y=r.split(h);Y[0]=O.join(s),r=Y.join(h)}}if(P||!1!==P&&-1===r.indexOf(e)){for(var H=r.split(h),U=0;U<H.length;U++){if(d+=(u=H[U]).length,U!==H.length-1)d+=h.length;else if(c)return z();if(!l||u.substring(0,F)!==l){if(S){if(T=[],rt(u.split(s)),mt(),i)return z()}else rt(u.split(s));if(m&&m<=U)return T=T.slice(0,m),z(!0)}}return z()}for(var M=r.indexOf(s,d),I=r.indexOf(h,d),it=new RegExp(nt(a)+nt(e),"g"),C=r.indexOf(e,d);;)if(r[d]!==e)if(l&&0===u.length&&r.substring(d,d+F)===l){if(-1===I)return z();I=r.indexOf(h,d=I+R),M=r.indexOf(s,d)}else if(-1!==M&&(M<I||-1===I))u.push(r.substring(d,M)),M=r.indexOf(s,d=M+_);else{if(-1===I)break;if(u.push(r.substring(d,I)),q(I+R),S&&(mt(),i))return z();if(m&&T.length>=m)return z(!0)}else for(C=d,d++;;){if(-1===(C=r.indexOf(e,C+1)))return c||x.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:T.length,index:d}),J();if(C===o-1)return J(r.substring(d,C).replace(it,e));if(e!==a||r[C+1]!==a){if(e===a||0===C||r[C-1]!==a){-1!==M&&M<C+1&&(M=r.indexOf(s,C+1)),-1!==I&&I<C+1&&(I=r.indexOf(h,C+1));var ht=X(-1===I?M:Math.min(M,I));if(r.substr(C+1+ht,_)===s){u.push(r.substring(d,C).replace(it,e)),r[d=C+1+ht+_]!==e&&(C=r.indexOf(e,d)),M=r.indexOf(s,d),I=r.indexOf(h,d);break}var K=X(I);if(r.substring(C+1+K,C+1+K+R)===h){if(u.push(r.substring(d,C).replace(it,e)),q(C+1+K+R),M=r.indexOf(s,d),C=r.indexOf(e,d),S&&(mt(),i))return z();if(m&&T.length>=m)return z(!0);break}x.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:T.length,index:d}),C++}}else C++}return J();function rt($){T.push($),y=d}function X($){var Ct=0;if(-1!==$){var vt=r.substring(C+1,$);vt&&""===vt.trim()&&(Ct=vt.length)}return Ct}function J($){return c||(void 0===$&&($=r.substring(d)),u.push($),d=o,rt(u),S&&mt()),z()}function q($){d=$,rt(u),u=[],I=r.indexOf(h,d)}function z($){return{data:T,errors:x,meta:{delimiter:s,linebreak:h,aborted:i,truncated:!!$,cursor:y+(p||0)}}}function mt(){f(z()),T=[],x=[]}},this.abort=function(){i=!0},this.getCharIndex=function(){return d}}function yt(n){var e=n.data,s=st[e.workerId],h=!1;if(e.error)s.userError(e.error,e.file);else if(e.results&&e.results.data){var l={abort:function(){h=!0,ft(e.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:gt,resume:gt};if(v(s.userStep)){for(var f=0;f<e.results.data.length&&(s.userStep({data:e.results.data[f],errors:e.results.errors,meta:e.results.meta},l),!h);f++);delete e.results}else v(s.userChunk)&&(s.userChunk(e.results,l,e.file),delete e.results)}e.finished&&!h&&ft(e.workerId,e.results)}function ft(n,e){var s=st[n];v(s.userComplete)&&s.userComplete(e),s.terminate(),delete st[n]}function gt(){throw new Error("Not implemented.")}function ut(n){if("object"!=typeof n||null===n)return n;var e=Array.isArray(n)?[]:{};for(var s in n)e[s]=ut(n[s]);return e}function B(n,e){return function(){n.apply(e,arguments)}}function v(n){return"function"==typeof n}return ct&&(t.onmessage=function(n){var e=n.data;if(void 0===g.WORKER_ID&&e&&(g.WORKER_ID=e.workerId),"string"==typeof e.input)t.postMessage({workerId:g.WORKER_ID,results:g.parse(e.input,e.config),finished:!0});else if(t.File&&e.input instanceof File||e.input instanceof Object){var s=g.parse(e.input,e.config);s&&t.postMessage({workerId:g.WORKER_ID,results:s,finished:!0})}}),(ot.prototype=Object.create(N.prototype)).constructor=ot,(at.prototype=Object.create(N.prototype)).constructor=at,(et.prototype=Object.create(et.prototype)).constructor=et,(A.prototype=Object.create(N.prototype)).constructor=A,g},void 0!==(Q=D.apply(pt,[]))&&(kt.exports=Q)}}]);