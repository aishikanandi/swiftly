"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[650],{8650:(w,u,g)=>{g.r(u),g.d(u,{CityModule:()=>j});var h=g(177),r=g(9417),t=g(7705),y=g(5794),C=g(7842),f=g(1626),P=g(6731),m=g(415);function _(a,p){if(1&a&&(t.j41(0,"option",28),t.EFF(1),t.k0s()),2&a){const e=p.$implicit;t.Y8G("value",e._id),t.R7$(1),t.JRh(e.countryName)}}function M(a,p){if(1&a){const e=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.checkZone_AddCity())}),t.EFF(1,"Add City"),t.k0s()}}function O(a,p){if(1&a){const e=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.updateCity())}),t.EFF(1,"Update City"),t.k0s()}}function b(a,p){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td")(6,"button",30),t.bIt("click",function(){const i=t.eBV(e).$implicit,c=t.XpG();return t.Njj(c.editbtn(i._id,i))}),t.nrm(7,"i",31),t.k0s()()()}if(2&a){const e=p.$implicit;t.R7$(2),t.JRh(e.countryDetails.countryName),t.R7$(2),t.JRh(e.city)}}const v=function(a,p,e){return{itemsPerPage:a,currentPage:p,totalItems:e}};let x=(()=>{class a{constructor(e,o,n,i,c){this.toastr=e,this._city=o,this.http=n,this.formBuilder=i,this.authService=c,this.addedCities=[],this.newCity="",this.isValidCity=!1,this.isDuplicateCity=!1,this.polygons=[],this.isInZone=!1,this.cordsArray=[],this.selectedCountry="",this.countryData=[],this.cityData=[],this.isaddbutton=!0,this.isupdatebutton=!1,this.isCountryDisabled=!1,this.page=1,this.citydata={countryname:"",cityname:""},this.totalPages=0,this.limit=5,this.currentPage=1,this.paginatedData=[],this.cityForm=this.formBuilder.group({countryname:["",r.k0.required],cityname:["",r.k0.required]})}ngOnInit(){this.cityForm=this.formBuilder.group({countryname:[""],cityname:[""]}),this.getCItyData(),this.getCountryNamefromDB(),this.initMap()}setLocation(e){e.geometry?e.geometry&&e.geometry.location&&(this.map.setCenter(e.geometry.location),this.map.setZoom(8),this.marker.setPosition(e.geometry.location),this.marker.setVisible(!0)):console.error("No geometry found for place:",e)}onPlaceChanged(){const e=this.autocomplete.getPlace();if(e.geometry&&e.geometry.location){const o=e.geometry.location.lat(),n=e.geometry.location.lng();console.log("Latitude:",o),console.log("Longitude:",n)}}initMap(){this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:20.5937,lng:78.9629},zoom:4});const e=document.getElementById("inputCity");this.autocomplete=new google.maps.places.Autocomplete(e),this.autocomplete.addListener("place_changed",()=>{const o=this.autocomplete.getPlace();this.onPlaceChanged(),this.setLocation(o)}),this.marker=new google.maps.Marker({map:this.map,draggable:!0,animation:google.maps.Animation.DROP,anchorPoint:new google.maps.Point(0,-29)}),this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),this.drawingManager.setMap(this.map),google.maps.event.addListener(this.drawingManager,"overlaycomplete",o=>{o.type===google.maps.drawing.OverlayType.POLYGON&&(this.polygon&&this.polygon.setMap(null),this.polygon=o.overlay)}),google.maps.event.addListener(this.polygon,"dragend",o=>{const n=this.polygon.getPath().getArray().map(i=>({lat:i.lat(),lng:i.lng()}));console.log("Updated Coordinates:",n)})}getCountryNamefromDB(){this._city.getcountryData().subscribe({next:e=>{this.countryData=e.countrydata},error:e=>{console.log(e)}})}getCItyData(){this._city.getcity(this.currentPage,this.limit).subscribe({next:e=>{this.cityData=e.citydata,this.count=e.count,this.totalPages=e.totalPage},error:e=>{console.log(e)}})}onPageSizeChange(e){this.limit=parseInt(e.target.value),this.currentPage=1,this.updatePaginatedData(),this.getCItyData()}onPageChange(e){e>=1&&e<=this.totalPages&&(this.currentPage=e,this.updatePaginatedData(),this.getCItyData())}updatePaginatedData(){const e=(this.currentPage-1)*this.limit;this.paginatedData=this.cityData.slice(e,e+this.limit)}removePolygon(){this.polygonObj&&this.polygonObj.forEach(e=>{e.setMap(null)},this.polygonObj=[],this.polygons=[])}onSelected(e){this.removePolygon(),this.selectedCountry=e,console.log(e);const o=this.countryData.find(n=>n._id===e);o&&(this.selectedCountryName=o.countryName,console.log(this.selectedCountryName),this._city.getCityPolygons(e).subscribe({next:n=>{console.log(n),n.forEach(i=>{this.polygons.push(i.coordinates)}),this.polygonObj=this.polygons.map(i=>new google.maps.Polygon({paths:i,editable:!1,draggable:!1,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map}))},error:n=>{console.log(n)}}),this.http.get(`https://restcountries.com/v3.1/name/${this.selectedCountryName}`).subscribe({next:n=>{let c=n.filter(l=>l.name.common==this.selectedCountryName)[0].cca2.toLowerCase();this.autocomplete.setTypes(["(cities)"]),this.autocomplete.setComponentRestrictions({country:[c]})},error:n=>{console.log("Country Selection Error: ",n.message),this.toastr.error(n.message)}}))}checkZone_AddCity(){if(""!=this.cityForm.value.countryname){const e=new google.maps.Geocoder,o=document.getElementById("inputCity");e.geocode({address:o.value},(n,i)=>{if("OK"===i)if(this.isInZone=google.maps.geometry.poly.containsLocation(n[0].geometry.location,this.polygon),1==this.isInZone){const l=this.polygon.getPath();this.coordinates=l.getArray().map(s=>({lat:s.lat(),lng:s.lng()})),console.log("Coordinates:",this.coordinates);const d={country_id:this.selectedCountry,city:o.value,coordinates:this.coordinates};console.log(d),this._city.addcity(d).subscribe({next:s=>{this.cityData.push(s.city),alert(s.message),this.getCItyData(),this.getCountryNamefromDB(),this.marker.setVisible(!1),this.marker.setPosition(null),this.polygon.setMap(null),this.cityForm.reset()},error:s=>{console.log(s.error.message),alert(s.error.message)}})}else alert("Location not Inside Zone");else alert("please choose city and create a zone")})}else alert("All Fields are Required")}editbtn(e,o){this.removePolygon(),console.log(o),this.id=e,this.inputValue=o.city,this.selectedCountryName=o.countryDetails.countryName,this.cityForm.get("countryname")?.disable(),this.cityForm.patchValue({countryname:o.countryDetails._id,cityname:o.city}),this.isaddbutton=!1,this.isupdatebutton=!0,console.log(o.coordinates),this.displayPolygon(o.coordinates)}displayPolygon(e){const o=e.map(i=>new google.maps.LatLng(i.lat,i.lng));this.polygon&&this.polygon.setMap(null),this.polygon=new google.maps.Polygon({paths:o,editable:!0,draggable:!0,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}),this.polygon.setMap(this.map);const n=new google.maps.LatLngBounds;e.forEach(i=>{n.extend(new google.maps.LatLng(i.lat,i.lng))}),this.map.fitBounds(n)}updateCity(){const e=new google.maps.Geocoder,o=document.getElementById("inputCity");e.geocode({address:o.value},(n,i)=>{if("OK"===i){const c=n[0].geometry.location;if(console.log(c),this.isInZone=google.maps.geometry.poly.containsLocation(c,this.polygon),1==this.isInZone&&""!=o.value){const l=this.polygon.getPath().getArray().map(s=>({lat:s.lat(),lng:s.lng()}));console.log(l);const d={city:o.value,coordinates:l};console.log(d),this._city.updateCity(this.id,d).subscribe({next:s=>{console.log(s),this.toastr.success(s.message),this.cityData.push(s.city),this.isupdatebutton=!1,this.isaddbutton=!0,this.cityForm.get("countryname")?.enable(),this.getCItyData(),this.getCountryNamefromDB(),this.marker.setVisible(!1),this.marker.setPosition(null),this.polygon.setMap(null),this.cityForm.reset()},error:s=>{console.log(s.error.message),alert(s.error.message)}})}else alert("Location not Inside Zone")}else alert("please choose city and create a zone")})}resetTimer(){this.authService.resetInactivityTimer()}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(y.tw),t.rXU(C.h),t.rXU(f.Qq),t.rXU(r.ok),t.rXU(P.u))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-city"]],decls:47,vars:15,consts:[[1,"parentFormContainer"],["id","formContainer"],[3,"formGroup"],["name","country","formControlName","countryname",3,"change"],["country",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["id","inputCity","placeholder","Enter city name","formControlName","cityname"],[3,"click",4,"ngIf"],[1,"p-4"],["id","map",1,"rounded"],[1,"d-flex","justify-content-center","align-items-center"],["for","pageSize"],[1,"custom-select"],["id","pageSize",1,"m-2",3,"ngModel","ngModelChange","change"],["value","5"],["value","10"],["value","20"],["value","50"],["value","100"],[1,"parenttableContainer"],["id","tableContainer"],[1,"table-responsive"],[1,"table"],[1,"bg-dark","text-light"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center"],[3,"maxSize","responsive","pageChange"],[3,"value"],[3,"click"],["id","updatebtn",3,"click"],[1,"fa-solid","fa-pen-to-square"]],template:function(o,n){if(1&o){const i=t.RV6();t.j41(0,"div",0)(1,"div",1)(2,"form",2)(3,"select",3,4),t.bIt("change",function(){t.eBV(i);const l=t.sdS(4);return t.Njj(n.onSelected(l.value))}),t.j41(5,"option",5),t.EFF(6,"Select country "),t.k0s(),t.DNE(7,_,2,2,"option",6),t.k0s(),t.nrm(8,"input",7),t.DNE(9,M,2,0,"button",8),t.DNE(10,O,2,0,"button",8),t.k0s()()(),t.j41(11,"div",9),t.nrm(12,"div",10),t.k0s(),t.j41(13,"div",11)(14,"label",12),t.EFF(15,"Show Data :"),t.k0s(),t.j41(16,"div",13)(17,"select",14),t.bIt("ngModelChange",function(l){return n.limit=l})("change",function(l){return n.onPageSizeChange(l)}),t.j41(18,"option",15),t.EFF(19,"Select Page"),t.k0s(),t.j41(20,"option",15),t.EFF(21,"5"),t.k0s(),t.j41(22,"option",16),t.EFF(23,"10"),t.k0s(),t.j41(24,"option",17),t.EFF(25,"20"),t.k0s(),t.j41(26,"option",18),t.EFF(27,"50"),t.k0s(),t.j41(28,"option",19),t.EFF(29,"100"),t.k0s()()()(),t.j41(30,"div",20)(31,"div",21)(32,"div",22)(33,"table",23)(34,"thead",24)(35,"tr")(36,"th"),t.EFF(37,"Country"),t.k0s(),t.j41(38,"th"),t.EFF(39,"City"),t.k0s(),t.j41(40,"th"),t.EFF(41,"Action"),t.k0s()()(),t.j41(42,"tbody"),t.DNE(43,b,8,2,"tr",25),t.nI1(44,"paginate"),t.k0s()()()()(),t.j41(45,"div",26)(46,"pagination-controls",27),t.bIt("pageChange",function(l){return n.onPageChange(l)}),t.k0s()()}2&o&&(t.R7$(2),t.Y8G("formGroup",n.cityForm),t.R7$(5),t.Y8G("ngForOf",n.countryData),t.R7$(2),t.Y8G("ngIf",n.isaddbutton),t.R7$(1),t.Y8G("ngIf",n.isupdatebutton),t.R7$(7),t.Y8G("ngModel",n.limit),t.R7$(26),t.Y8G("ngForOf",t.i5U(44,8,n.cityData,t.sMw(11,v,n.limit,n.currentPage,n.count))),t.R7$(3),t.Y8G("maxSize",5)("responsive",!0))},dependencies:[h.Sq,h.bT,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.vS,r.j4,r.JD,m.ej,m.kf],styles:["#map[_ngcontent-%COMP%]{height:400px;width:100%;border:1px solid rgb(165,165,165);margin-top:20px}.parentFormContainer[_ngcontent-%COMP%]{display:flex;justify-content:space-around;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif}#formContainer[_ngcontent-%COMP%]{align-items:center;justify-content:center}#formContainer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], #formContainer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px;width:300px;margin:10px}#formContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:10px;padding:8px 16px;background-color:#00bb06;color:#fff;border:none;cursor:pointer}#pageSize[_ngcontent-%COMP%]{padding:5px}#formContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#007806}@media screen and (max-width: 650px){#parentFormContainer[_ngcontent-%COMP%], #formContainer[_ngcontent-%COMP%]{display:block}#formContainer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], #formContainer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:10px}#tableContainer[_ngcontent-%COMP%]{width:90%;background-color:#fff;border-radius:10px;box-shadow:4px 4px 16px #000;max-width:600px;padding:20px;margin:40px}}.parenttableContainer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}#tableContainer[_ngcontent-%COMP%]{width:90%;background-color:#fff;border-radius:10px;box-shadow:4px 4px 16px #000;padding:20px;margin:40px}.updateContainer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;margin-top:5%}.container[_ngcontent-%COMP%]{border-radius:5px;box-shadow:2px 2px 6px #000;padding:20px;transition:all linear .3s}.container[_ngcontent-%COMP%]:hover{transform:scale(1);transition:all linear .3s;z-index:1;box-shadow:4px 4px 16px #00b3ff}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto}@media (max-width: 360px){.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 480px){.table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > th[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > thead[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%], .table-responsive[_ngcontent-%COMP%] > .table[_ngcontent-%COMP%] > tfoot[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{font-size:14px}}"]})}}return a})();var F=g(8498);const k=[{path:"",component:x,pathMatch:"full"}];let j=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[h.MD,F.iI.forChild(k),r.YN,r.X1,m.ed]})}}return a})()}}]);